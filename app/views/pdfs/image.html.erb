<div class="max-w-6xl mx-auto p-8">
  <!-- Image Navigation -->
  <div class="bg-white rounded-lg shadow-md p-4 mb-6">
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-4">
        <% if @previous_image %>
          <%= link_to game_pdf_image_path(@game, @pdf, @previous_image.id),
              class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded font-medium text-sm transition-colors" do %>
            ← Previous
          <% end %>
        <% else %>
          <button disabled class="bg-gray-300 text-gray-500 px-4 py-2 rounded font-medium text-sm cursor-not-allowed">
            ← Previous
          </button>
        <% end %>

        <span class="text-gray-600 font-medium">
          Image <%= @image_index + 1 %> of <%= @total_images %>
        </span>

        <% if @next_image %>
          <%= link_to game_pdf_image_path(@game, @pdf, @next_image.id),
              class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded font-medium text-sm transition-colors" do %>
            Next →
          <% end %>
        <% else %>
          <button disabled class="bg-gray-300 text-gray-500 px-4 py-2 rounded font-medium text-sm cursor-not-allowed">
            Next →
          </button>
        <% end %>
      </div>

      <div class="flex gap-2">
        <%= button_to "Reclassify", run_job_game_pdf_path(@game, @pdf, method: :classify_images),
            method: :post,
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-medium text-sm transition-colors",
            data: { turbo_confirm: "This will reclassify all images. Continue?" } %>
        <%= button_to "Delete", delete_images_game_pdf_path(@game, @pdf, image_ids: [@image.id]),
            method: :post,
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-medium text-sm transition-colors",
            data: { turbo_confirm: "Are you sure you want to delete this image? This action cannot be undone." } %>
      </div>
    </div>
  </div>

  <!-- Image Display -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-center mb-4">
      <%= image_tag @image, class: "max-w-full h-auto rounded shadow-lg", style: "max-height: 70vh;" %>
    </div>
  </div>

  <!-- Image Information -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-semibold mb-4">Image Information</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Classification -->
      <% if @image.blob.metadata['classification'].present? %>
        <div>
          <h4 class="text-sm font-semibold text-gray-600 mb-1">Classification</h4>
          <div class="flex items-center gap-2">
            <span class="inline-block px-3 py-1 text-sm font-semibold rounded bg-blue-100 text-blue-800">
              <%= @image.blob.metadata['classification'] %>
            </span>
            <% if @image.blob.metadata['recommendation'] == 'remove' %>
              <span class="inline-block px-3 py-1 text-sm font-semibold rounded bg-red-100 text-red-800">
                Remove
              </span>
            <% elsif @image.blob.metadata['recommendation'] == 'keep' %>
              <span class="inline-block px-3 py-1 text-sm font-semibold rounded bg-green-100 text-green-800">
                Keep
              </span>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Filename -->
      <div>
        <h4 class="text-sm font-semibold text-gray-600 mb-1">Filename</h4>
        <p class="text-gray-700"><%= @image.filename %></p>
      </div>

      <!-- File Size -->
      <div>
        <h4 class="text-sm font-semibold text-gray-600 mb-1">File Size</h4>
        <p class="text-gray-700"><%= number_to_human_size(@image.byte_size) %></p>
      </div>

      <!-- Content Type -->
      <div>
        <h4 class="text-sm font-semibold text-gray-600 mb-1">Content Type</h4>
        <p class="text-gray-700"><%= @image.content_type %></p>
      </div>

      <!-- Source -->
      <% if @image.blob.metadata['source'].present? %>
        <div>
          <h4 class="text-sm font-semibold text-gray-600 mb-1">Source</h4>
          <p class="text-gray-700"><%= @image.blob.metadata['source'] %></p>
        </div>
      <% end %>

      <!-- Classified At -->
      <% if @image.blob.metadata['classified_at'].present? %>
        <div>
          <h4 class="text-sm font-semibold text-gray-600 mb-1">Classified At</h4>
          <p class="text-gray-700"><%= Time.parse(@image.blob.metadata['classified_at']).strftime("%B %d, %Y at %I:%M %p") rescue @image.blob.metadata['classified_at'] %></p>
        </div>
      <% end %>
    </div>

    <!-- Description -->
    <% if @image.blob.metadata['description'].present? %>
      <div class="mt-6">
        <h4 class="text-sm font-semibold text-gray-600 mb-2">Description</h4>
        <div class="prose prose-sm max-w-none">
          <p class="text-gray-700"><%= @image.blob.metadata['description'] %></p>
        </div>
      </div>
    <% end %>

    <!-- Classification Reasoning -->
    <% if @image.blob.metadata['reasoning'].present? %>
      <div class="mt-6">
        <h4 class="text-sm font-semibold text-gray-600 mb-2">Classification Reasoning</h4>
        <div class="prose prose-sm max-w-none">
          <p class="text-gray-700 italic"><%= @image.blob.metadata['reasoning'] %></p>
        </div>
      </div>
    <% end %>
  </div>
</div>
