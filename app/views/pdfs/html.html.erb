<style>
  /* Scale down PDF content to compensate for high-res extraction (zoom 3.0) */
  /* Zoom 3.0 is 2x the default 1.5, so we scale down by 0.5 to get back to 1.5 effective size */
  #pdf-content {
    transform: scale(0.5);
    transform-origin: top center;
    width: 200%; /* Compensate for scale to maintain layout */
    margin: 0 auto;
  }

  .zoom-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
    background: #f3f4f6;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
  }

  .zoom-control input[type="range"] {
    width: 200px;
  }

  <% if @pdf.fonts.attached? %>
    <% @pdf.fonts.each do |font| %>
      <% if font.metadata['font_name'].present? %>
        <%
          ext = font.filename.extension.to_s
          format = case ext
                   when 'ttf' then 'truetype'
                   when 'otf' then 'opentype'
                   when 'cff' then 'opentype'
                   else 'truetype'
                   end

          # Infer font-weight from font name
          font_name = font.metadata['font_name']
          font_weight = if font_name.match?(/Bold/i) && !font_name.match?(/Semi/i)
                          '700'
                        elsif font_name.match?(/SemiBold|Semibold/i)
                          '600'
                        elsif font_name.match?(/Medium/i)
                          '500'
                        elsif font_name.match?(/Light/i) && !font_name.match?(/Ultra/i)
                          '300'
                        elsif font_name.match?(/UltraLight|Thin/i)
                          '100'
                        elsif font_name.match?(/Black|Heavy/i)
                          '900'
                        else
                          '400'
                        end

          # Infer font-style from font name
          font_style = font_name.match?(/Italic|Obl/i) ? 'italic' : 'normal'
        %>
        @font-face {
          font-family: '<%= font.metadata['font_name'] %>';
          src: url('<%= rails_blob_path(font, only_path: true) %>') format('<%= format %>');
          font-weight: <%= font_weight %>;
          font-style: <%= font_style %>;
        }
      <% end %>
    <% end %>
  <% end %>
</style>

<div class="zoom-control">
  <label for="zoom-slider">Zoom:</label>
  <input type="range" id="zoom-slider" min="25" max="200" value="50" step="5">
  <span id="zoom-value">50%</span>
</div>

<div style="display: flex; justify-content: center;">
  <% if @pdf.html_content.present? %>
    <div id="pdf-content">
      <% doc = Nokogiri::HTML.fragment(@pdf.html_content) %>
      <%= doc.to_html.html_safe %>
    </div>
  <% else %>
    <p class="text-gray-500">No HTML content available for this PDF.</p>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('zoom-slider');
    const zoomValue = document.getElementById('zoom-value');
    const pdfContent = document.getElementById('pdf-content');

    if (slider && zoomValue && pdfContent) {
      slider.addEventListener('input', function() {
        const scale = this.value / 100;
        const width = 100 / scale;

        pdfContent.style.transform = `scale(${scale})`;
        pdfContent.style.width = `${width}%`;
        zoomValue.textContent = `${this.value}%`;
      });
    }
  });
</script>