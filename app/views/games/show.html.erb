<% content_for :navbar_center do %>
  <h1 class="text-xl font-bold text-white"><%= @game.pdfs.first.name %></h1>
<% end %>

<!-- Game Page (Notes + Sidebar + PDFs) -->
<%= react_component("GamePage", props: {
  gameId: @game.id,
  pdfs: @game.pdfs.select(&:persisted?).map { |pdf|
    {
      id: pdf.id,
      name: pdf.name,
      description: pdf.description,
      image_count: pdf.images.count,
      url: game_pdf_path(@game, pdf)
    }
  },
  notes: @game.game_notes.chronological.map { |note|
    {
      id: note.id,
      global_id: note.to_global_id.to_s,
      title: note.title,
      note_type: note.note_type,
      content: note.content,
      created_at: note.created_at.iso8601,
      stats: note.stats,
      actions: note.actions,
      history: note.history,
      images: note.images.attached? ? note.images.map { |img| rails_blob_path(img) } : []
    }
  },
  selectedNoteIds: params[:context_items] || [],
  plan: @game.agent&.plan || [],
  model: @game.user.preferred_model,
  conversationHistory: (@game.agent&.conversation_history || []).map { |msg|
    result = {
      role: msg['role'],
      content: msg['content']
    }
    result[:tool_calls] = msg['tool_calls'] if msg['tool_calls'].present?
    result[:tool_call_id] = msg['tool_call_id'] if msg['tool_call_id'].present?
    result
  }
}) %>
